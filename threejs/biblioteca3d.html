<!DOCTYPE html>
<html>

<head>
    <title>Exposición: El Cyborg Chamán</title>
 <link
    rel="shortcut icon"
    href="images/cyborgshaman.jpg"
  />

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
	.button {
	    position: fixed;
	    left:5%;
	    bottom: 5%;
	    z-index: 100;
	}
	
    </style>
</head>

<body>
  <video id="video" width='1366' height='768' loop style="display:none"></video>
  
  
    <script src="js/three.js"></script>
    <script src="js/controls/OrbitControls.js"></script>
    <script src="js/csg.js"></script>
    <script src="js/THREE.CSG.js"></script>
    <script src="js/WebGL.js"></script>
 <!-- <script src="https://gist.github.com/XanderLuciano/5ce51976fd18beffdc118fd29b547c05.js"></script> -->

    <script>

      if (WEBGL.isWebGLAvailable() === false) {

            document.body.appendChild(WEBGL.getWebGLErrorMessage());

      }

      

      // Imágenes para proyectar en las paredes
      var paredFrontalImagen="images/cyborgshaman.jpg";
      
      //agregar video
      const video = document.getElementById( 'video' );
      //const videotexture = new THREE.VideoTexture( video );
      var usevideo=  1 ;//1 true, 0 false
      var videofile="output.mp4"

      //vars for mouse click detection
      var targetList = [];
      var projector, mouse = { x: 0, y: 0 };


      
      var scene, aspect, camera, renderer, controls, cyborg;
      init();
      animate();

      function init() {
          if (WEBGL.isWebGLAvailable() === false) {
              document.body.appendChild(WEBGL.getWebGLErrorMessage());
          }
          //INICIALIZACIÓN
          scene = new THREE.Scene();
	  scene.background = new THREE.Color(0x2244aa);
          aspect = window.innerWidth / window.innerHeight;
          camera = new THREE.PerspectiveCamera(50, aspect, 0.1, 1000);
          renderer = new THREE.WebGLRenderer();
          renderer.setSize(window.innerWidth, window.innerHeight);
          document.body.appendChild(renderer.domElement);
          controls = new THREE.OrbitControls(camera, renderer.domElement);

	  controls.panSpeed= 1.8;
	  //controls.maxDistance=25;
	  controls.enableDamping=false;
	  
          //ELEMENTOS COMUNES
	  var pihalf=THREE.Math.degToRad(90);
          var origin = new THREE.Vector3(0, 0, 0);
          var x = new THREE.Vector3(1, 0, 0);
          var y = new THREE.Vector3(0, 1, 0);
          var z = new THREE.Vector3(0, 0, 1);
          var colorPared = new THREE.Color(0xffddaa);
          var colorLadrillo = new THREE.Color(0xaa4411);
          var colorPiso = new THREE.Color(0x999988);
          var colorVerde = new THREE.Color(0x026101);
          var colorAzul = new THREE.Color(0x021091);
          var colorOscuro = new THREE.Color(0x3f3f2c);

	  var intersected_object = 0;

	  
          
          //ROTARLAS PARA QUE QUEDEN EN EL ESPACIO ADECUADO
          

	  
   
	  //CREAR ILUMINACIÓN
          var ambient = new THREE.AmbientLight(0xbbbbff, 0.7);
          scene.add(ambient);
	  
	  var directionalLight1 = new THREE.DirectionalLight(0x335588, 0.5);
          directionalLight1.position.set(-1, 1, 1).normalize();
          scene.add(directionalLight1);

          var ambientout = new THREE.AmbientLight(0xbbbbff, 0.2);
	  ambientout.position.set(30, 50,20)
          scene.add(ambientout);
	  // hemiLight = new THREE.HemisphereLight( 0x0000ff, 0x008800, 0.6 );
	  // scene.add(hemiLight);


	  var moonLight = new THREE.SpotLight(0xffdd83, 2, 1000, 1.5, 0.5);
          moonLight.position.set(300, 500, 200);
          scene.add(moonLight);

 

	  
	  
	  
          //CREAR LOS MATERIALES
	  //box
          var materialNegro = new THREE.MeshStandardMaterial({
              color: 0x010101,
              roughness: 0.5,
	      metalness: 0.1,
          });
          var materialPared = new THREE.MeshStandardMaterial({
              color: colorPared,
              metalness: 0,
              roughness: 0.5,
	      
          });
                    
          var materialbomb = new THREE.MeshBasicMaterial({
              color: 0xffffaa
          });
	  
          //TEXTURAS
	  
          var woodBase = new THREE.TextureLoader().load('textures/ColorMad.jpg');
          var woodNormal = new THREE.TextureLoader().load('textures/NormalMad.jpg');
          var woodMaterial = new THREE.MeshStandardMaterial({
              map: woodBase,
              normalMap: woodNormal
          });
          
          var lightWoodBase = new THREE.TextureLoader().load('textures/lightWood.jpg');
          //var woodNormal = new THREE.TextureLoader().load('textures/NormalMad.jpg');
          var woodMaterial = new THREE.MeshStandardMaterial({
              map: lightWoodBase,
              normalMap: lightWoodBase
          });
	  
	  
	  
	  // // material pared izquierda
          //var patBase = new THREE.TextureLoader().load(paredIzquierdaImagen);
          var patNormal = new THREE.TextureLoader().load('textures/NormalPat.jpg');
          
          // var materialParedPuerta = new THREE.MeshStandardMaterial({
          //     //color: 0xffffff,
          //     roughness: 0.5,
	  //     metalness: 0.1,
          //     transparent: true,
          //     opacity: 0.8,
          //     map: patBase,
          //     normalMap: patNormal
          // });
	  
	  //material pared frontal
	  var projBase1 = new THREE.TextureLoader().load(paredFrontalImagen);

	  // in case of video
	  if (usevideo==1){
	      video.src = videofile;
	      video.load();
	      //video.play();

	      videoImage = document.createElement( 'canvas' );
	      videoImage.width = 1366;
	      videoImage.height = 768;
	      
	      videoImageContext = videoImage.getContext( '2d' );
	      // background color if no video present
	      videoImageContext.fillStyle = '#000000';
	      videoImageContext.fillRect( 0, 0, videoImage.width, videoImage.height );
	      

	      
	      videoTexture = new THREE.VideoTexture( videoImage );
	      videoTexture.minFilter = THREE.LinearFilter;
	      videoTexture.magFilter = THREE.LinearFilter;
	
	      var frontalTexture=videoTexture;
	  } else {
	      var frontalTexture=projBase1;
	  }
	  
	  var Proyeccion1 = new THREE.MeshStandardMaterial({
              //color: 0xffffff,
              roughness: 0.1,
	      metalness: 0.2,
              transparent: true,
              opacity: 0.8,
              map: projBase1,
              normalMap: patNormal
          });

	  
	  
	  //material pared derecha
          // var projBase2 = new THREE.TextureLoader().load(paredDerechaImagen);
	  // var Proyeccion2 = new THREE.MeshStandardMaterial({
          //     //color: 0xffffff,
          //     roughness: 0.1,
	  //     metalness: 0.2,
          //     //transparent: true,
          //     //opacity: 0.8,
          //     map: frontalTexture,
          //     //normalMap: patNormal
          // });

	  
	  
          var matPuerta = new THREE.MeshStandardMaterial({
              color: colorLadrillo,
              metalness: 0,
              roughness: 0.2,
              map: woodBase,
              normalMap: woodNormal,
          });
	  var materialLadrillo = new THREE.MeshStandardMaterial({
              color: colorLadrillo,
              metalness: 0,
              roughness: 0.2,
              //map: woodBase,
              //normalMap: woodNormal,
          });
	  var materialVerde = new THREE.MeshStandardMaterial({
              color: colorVerde,
              metalness: 0,
              roughness: 0.6,
              //map: woodBase,
              //normalMap: woodNormal,
          });
	  
          var materialPiso = new THREE.MeshStandardMaterial({
              color: colorPiso,
              metalness: 0.2,
              //transparent: true,
              roughness: 0.1,
          });
          var materialMadera = new THREE.MeshStandardMaterial({
              color: colorPiso,
              metalness: 0.2,
              //transparent: true,
              roughness: 0.1,
              map: lightWoodBase,
              normalMap: woodNormal,
          });


          var materialCristal= new THREE.MeshBasicMaterial({ 
              color: 0xaaaaaa , 
              side: THREE.DoubleSide, 
              transparent: true,
	      metalness: 0.8,
	      roughness: 0,
              opacity: 0.1
          });


//////////////////////////////////////////////////////////
	  
          //EXP MIO


	  // CSG
          // var box1 = new THREE.Mesh(boxGeometry);
          // var box2 = new THREE.Mesh(boxGeometry2);
          // box2.position.z = 1;
          // var box1CSG = THREE.CSG.fromMesh(box1);
          // var box2CSG = THREE.CSG.fromMesh(box2);
          // var result = box1CSG.subtract(box2CSG);
          // var pasillo = THREE.CSG.toMesh(result);



	  var size = 30;
          var arrowSize = 10;
          var divisions = size;
          
          //CREAR LAS GRILLAS PARA EL ESCENARIO
          var axesHelper = new THREE.AxesHelper(arrowSize);
          scene.add(axesHelper);
	  



	  
          //CREAR LAS GEOMETRIAS
	  var planoVerde = new THREE.PlaneGeometry(6000, 6000);
          var pV = new THREE.Mesh(planoVerde, materialVerde);
          pV.rotateX(-1.5708);
          //par2.rotateZ(-1.5708);
          pV.position.y = -10;
	  scene.add(pV);
	  

	  var xsize = 110;//half size, auditorium 10=1m
	  var zsize = 160;//deep  
	  var gruesoPared = 2;//20cm
	  // var ground = -10;//20cm
	  

	  //base
	  var baseGeometry = new THREE.BoxGeometry(2*xsize, 10, zsize);
	  var base0 = new THREE.Mesh(baseGeometry, materialPiso);
          base0.position.set( 0, -10, -0.5*zsize);
	  scene.add(base0);

	  var gridHelperXZ = new THREE.GridHelper(zsize, 0.5*zsize, colorOscuro, colorOscuro);
          gridHelperXZ.rotateOnWorldAxis(y, pihalf);
	  base0.position.set( 0, 0, -zsize/2);
	  //gridHelperXZ.position.y = -14.99;
	  scene.add(gridHelperXZ);
	  

	  var base1 = new THREE.BoxGeometry(xsize-2, 12, 40);// 4m back
	  var baseAudit = new THREE.Mesh(base1, materialPiso);
          baseAudit.position.set = (0.5*xsize, 6, -zsize+20);
	  scene.add(baseAudit);
	  


	  
	  //pared lateral
	  var paredDerecha = new THREE.BoxGeometry(gruesoPared, 50, zsize);
          var pared1 = new THREE.Mesh(paredDerecha, materialPared);
          pared1.position.set(xsize, );
	  scene.add(pared1);
	  //pared atras
	  var paredAtras = new THREE.BoxGeometry(xsize, 50, gruesoPared);
          var pared2 = new THREE.Mesh(paredAtras, materialPared);
          pared2.position.z = zsize/2;
	  scene.add(pared2);
	  



	  

	  var blackBoxsmall = new THREE.BoxGeometry(3, 3, 3);
	  var boxsmall = new THREE.Mesh(blackBoxsmall);	  
	  boxsmall.material= materialNegro;
	  boxsmall.position.set(3, 20, -zsize);
          scene.add(boxsmall);
          
	  var cyborgSquare = new THREE.PlaneGeometry(8, 8);
	  var cyborg = new THREE.Mesh(cyborgSquare, Proyeccion1);
          // cyborg.position.z =20;
	  scene.add(cyborg);


	  var ventana1 = new THREE.PlaneGeometry(50, 50);
	  var cyborg = new THREE.Mesh(ventana1, materialCristal);
          // cyborg.position.z =20;
	  scene.add(ventana1);




	  //not yet
	  
	  var bombiGeometry = new THREE.SphereGeometry(1.5, 15, 15);
          var mycylinder = new THREE.CylinderGeometry(4, 5, 5, 30);
          

      
	  
	  
	  
	  
	  
	  targetList.push(boxsmall);
	  // initialize object to perform world/screen calculations
	  projector = new THREE.Projector();
	  
	  // when the mouse moves, call the given function
	  document.addEventListener( 'mousedown', onDocumentMouseDown, false );


	  //AGREGAR A LA ESCENA LOS DIFERENTES ELEMENTOS
	  
          //scene.add(pasillo);
	  //scene.add(box3);
	  //scene.add(boxsmall);

	  //pared
          //scene.add(par1);
          //scene.add(par2);
          //scene.add(parfo);
          //scene.add(pb1);
          // scene.add(pb2);
          // scene.add(pbf);
          // scene.add(pbfback);

	  //piso
          //scene.add(piso);
	  
          // scene.add(manubrio);
          // scene.add(b1);
          // scene.add(b2);
          //scene.add(bmoon);
          // scene.add(coso3);
          // scene.add(coso4);
          // scene.add(cosa1);
	  
          // scene.add(cosAR);
          // scene.add(cosAR2);
	  
	  // //columnas
          // scene.add(bar3);
          // scene.add(bar4);
          // scene.add(bara3);
          // scene.add(bara4);

	  






	  camera.position.x = 0;
          camera.position.y = 10;
          camera.position.z = 80;
          camera.lookAt(origin);
      }

      function animate() {
          requestAnimationFrame(animate);
          controls.update();
	  if (usevideo==1)  {
	      videoTexture.needsUpdate=true;
	      //update();
	  }
          render();
	  
      }


      

      
      //function render() {
	  //cube[0].rotation.x += 0.01;
	  //cube[0].rotation.y += 0.01;
	  //cube[2].rotation.x += 0.01;
	  //cube[2].rotation.y += 0.01;
	  //cube.rotation.x += 0.01;
	  //cube.rotation.y += 0.01;
	  //renderer.render(scene, camera);
      //}

      document.onkeydown=function(e)
      {
	  if ( e.keyCode==80)//p
	      video.play();
	  
	  if ( e.keyCode==32 )// space
	      video.pause();
	  
	  if ( e.keyCode==83 ) // s, stop video
	  {
	      video.pause();
	      video.currentTime = 0;
	  }
	  
	  if ( e.keyCode==82 ) //r rewind:
	      //video.currentTime = 0;
	      controls.saveState();
	  
	  if ( e.keyCode==84 ) //r
	      controls.reset();
	  
	  //controls.update();
	  //stats.update();
      }


      
      
      function render() {
	  if (usevideo==1)
	  {	
	      if ( video.readyState === video.HAVE_ENOUGH_DATA ) 
	      {
		  videoImageContext.drawImage( video, 0, 0 );
		  if ( videoTexture ) 
		      videoTexture.needsUpdate = true;
	      }

	  }
      
	  renderer.render( scene, camera );
      }


      function onDocumentMouseDown( event ) {
	  // the following line would stop any other event handler from firing
	  // (such as the mouse's TrackballControls)
	  // event.preventDefault()
	  
	  console.log("Click.");
	  
	  // update the mouse variable
	  mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
	  mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
	  
	  // find intersections
	  
	  // create a Ray with origin at the mouse position
	  //   and direction into the scene (camera direction)
	  var vector = new THREE.Vector3( mouse.x, mouse.y, 1 );
	  projector.unprojectVector( vector, camera );
	  var ray = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

	  // create an array containing all objects in the scene with which the ray intersects
	  var intersects = ray.intersectObjects( targetList );
	
	  // if there is one (or more) intersections
	  if ( intersects.length > 0 ) {
	      console.log("Hit @ " + toString( intersects[0].point ) );
	      
	      toggleVideoView()
	      controls.maxDistance=200;


	      // change the color of the closest face.
	      //intersects[ 0 ].face.color.setRGB( 0.8 * Math.random() + 0.2, 0, 0 ); 
	      //
	      //intersects[ 0 ].object.geometry.colorsNeedUpdate = true;
	  }

      }



      
      var isvideoplaying=0;

      function toggleVideoView()
      {
	  if ( isvideoplaying==0 ) //play video
	  {
	      video.play();
	      isvideoplaying=1;
	      //scene.add(cyborg);
	  }
	  else {
	      if( isvideoplaying==1 ) // pause video
	      {
		  video.pause();
		  isvideoplaying=0;
		  //scene.remove(cyborg);
	      }
	  }
	  
      }

	  
    </script>
    <!-- <button id='button' class="button" onClick="toggleVideoView() "> * </button> -->
    
</body>

</html>

